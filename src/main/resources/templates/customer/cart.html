<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Shopping Cart</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <!--    Tailwind CSS & Other CDN style-->
        <link th:href="@{/css/tailwind-output.css}" rel="stylesheet" />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
            integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer" />
        <!-- Add Google Fonts Import -->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
            rel="stylesheet" />
        <!--    Library JS-->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

        <!--    CSRF Token-->
        <meta name="_csrf" th:content="${_csrf?.token}" />
        <!--    Font-->
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
            rel="stylesheet" />
    </head>
    <body class="bg-[#FFFAFA] font-[Poppins]">
        <div class="w-full bg-black">
            <h1 class="text-white py-2 justify-center text-center mx-3">
                Christmas Sale For All Items And Free Express Delivery -
                <span class="font-bold">OFF 50%!</span> Shop now only at, Keiko
                Shop!
            </h1>
        </div>
        <!-- Navbar -->
        <nav class="bg-white border-gray-200 border-b">
            <div
                class="min-w-screen-xl px-10 flex-wrap items-center justify-between mx-auto p-4 grid grid-cols-5">
                <!-- LOGO -->
                <a
                    href="/home"
                    class="flex items-center justify-center rtl:space-x-reverse">
                    <img src="/images/Logo.png" class="h-24"
                        alt="KeikoShop Logo" />
                    <h1
                        class="text-3xl text-[#AC690B] font-semibold hidden lg:block">
                        Keikoshop
                    </h1>
                </a>
                <!-- NAVIGATION LINKS -->
                <div
                    class="hidden lg:flex lg:order-2 lg:mr-auto items-center justify-center mx-auto">
                    <div
                        class="hidden lg:flex lg:mr-auto items-center justify-center mx-auto">
                        <div class="mr-9 flex items-center relative">
                            <a href="/cart/my">
                                <i
                                    class="fa-solid fa-cart-shopping text-2xl text-[#e59018] cursor-pointer hover:text-[#AC690B]"></i>
                                <div
                                    th:if="${cartItems.size() > 0}"
                                    class="absolute inline-flex items-center justify-center w-5 h-5 text-[10px] font-bold text-white bg-red-500 border-2 border-white rounded-full -top-2 -end-2">
                                    <h1 th:text="${cartItems.size()}"></h1>
                                </div>
                            </a>
                        </div>
                        <div class="h-10 w-px bg-gray-400"></div>
                    </div>
                    <ul class="flex space-x-2 items-center ml-6">
                        <li>
                            <button
                                id="userDropdownHomeToggle"
                                class="text-[#e59018] hover:text-white border border-[#e59018] hover:bg-[#e59018] focus:ring-4 focus:outline-none focus:ring-yellow-200 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 my-2 flex justify-center items-center"
                                type="button">
                                <span class="me-2">Hi, <span
                                        th:text="${user.username}"></span></span>
                            </button>
                        </li>
                    </ul>
                </div>
                <!-- Middle Bar -->
                <div class="col-start-2 col-span-3 p-5">
                    <div
                        class="relative w-xl lg:min-w-xl lg:order-1 lg:mx-auto hidden lg:block">
                        <h1
                            class="text-center text-2xl font-bold"
                            th:text="${cartItems.size() == 0 ? 'Cart' : 'Cart (' + cartItems.size() + ')'}">
                            Cart
                        </h1>
                    </div>
                </div>
                <!-- HAMBURGER MENU -->
                <div class="flex justify-end lg:order-2">
                    <button
                        type="button"
                        data-collapse-toggle="navbar-search"
                        aria-controls="navbar-search"
                        aria-expanded="false"
                        class="lg:hidden text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 me-1">
                        <svg
                            class="w-5 h-5"
                            aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 20 20">
                            <path
                                stroke="currentColor"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" />
                        </svg>
                        <span class="sr-only">Search</span>
                    </button>
                    <button
                        data-collapse-toggle="navbar-search"
                        type="button"
                        class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg lg:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                        aria-controls="navbar-search"
                        aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg
                            class="w-5 h-5"
                            aria-hidden="true"
                            xmlns="http://www.w3.org/2000/svg"
                            fill="none"
                            viewBox="0 0 17 14">
                            <path
                                stroke="currentColor"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M1 1h15M1 7h15M1 13h15" />
                        </svg>
                    </button>
                </div>
            </div>
        </nav>
        <!-- Dropdown menu -->
        <div
            id="userDropdownHome"
            class="absolute hidden right-20 top-32 bg-[#FFFAFA] divide-y divide-gray-100 rounded-lg shadow-xl w-72 mt-2">
            <div class="px-4 py-3 text-sm text-gray-900 dark:text-white">
                <div class="font-medium truncate text-black"
                    th:text="${user.email}">
                    name@flowbite.com
                </div>
            </div>
            <ul
                class="py-2 text-sm text-gray-700"
                aria-labelledby="dropdownInformationButton">
                <li>
                    <a
                        href="#"
                        class="flex flex-row items-center px-4 py-2 hover:bg-gray-100">
                        <div class="text-center w-4 h-4 mr-2">
                            <i class="fa-solid fa-heart"></i>
                        </div>
                        <span>Wishlist</span>
                    </a>
                </li>
                <li>
                    <a
                        href="/cart/my"
                        class="flex flex-row items-center px-4 py-2 hover:bg-gray-100">
                        <div class="text-center w-4 h-4 mr-2">
                            <i class="fa-solid fa-cart-shopping"></i>
                        </div>
                        <span>Keranjang Belanja</span>
                    </a>
                </li>
                <li>
                    <a
                        href="/pesanan-saya"
                        class="flex flex-row items-center px-4 py-2 hover:bg-gray-100">
                        <div class="text-center w-4 h-4 mr-2">
                            <i class="fa-solid fa-receipt"></i>
                        </div>
                        <span>Pesanan Saya</span>
                    </a>
                </li>
            </ul>
            <div class="py-2">
                <a
                    href="/admin/products/manage-products"
                    th:if="${isAdmin}"
                    class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">Admin
                    Menu</a>
                <form action="/api/users/logout" method="post">
                    <input type="hidden" name="username" value="yourUsername" />
                    <input type="hidden" name="_csrf" value="${_csrf.token}" />
                    <button
                        type="submit"
                        class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full">
                        Sign out
                    </button>
                </form>
            </div>
        </div>
        <!-- Navbar End -->

        <!-- BODY -->
        <div
            class="grid grid-cols-1 sm:grid-cols-2 gap-4 p-4 sm:p-8">
            <div class="flex flex-col gap-4">
                <!-- address -->
                <div class="max-w-4xl">
                    <div
                        class="h-full border border-black-300 p-4 rounded bg-[#F2F2F2]">
                        <div
                            class="flex flex-row items-center justify-start text-start gap-5">
                            <i class="fa-solid fa-location-dot text-5xl"></i>
                            <div>
                                <h2 class="text-lg font-semibold mb-2">Delivery
                                    Address</h2>
                                <span class="text-red-500">Add a shipping
                                    address to get an estimate of the cost and
                                    delivery time.</span>
                            </div>
                        </div>
                        <form class="mt-4">
                            <div class="mb-4">
                                <label for="address-line1"
                                    class="block text-sm font-medium text-gray-700">Address
                                    Line 1</label>
                                <input type="text" id="address-line1"
                                    name="address-line1"
                                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm"
                                    placeholder="123 Main St" required>
                            </div>
                            <div class="mb-4">
                                <label for="address-line2"
                                    class="block text-sm font-medium text-gray-700">Address
                                    Line 2</label>
                                <input type="text" id="address-line2"
                                    name="address-line2"
                                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm"
                                    placeholder="Apartment, suite, etc.">
                            </div>
                            <div class="mb-4">
                                <label for="city"
                                    class="block text-sm font-medium text-gray-700">City</label>
                                <input type="text" id="city" name="city"
                                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm"
                                    required>
                            </div>
                            <div class="mb-4">
                                <label for="state"
                                    class="block text-sm font-medium text-gray-700">State/Province</label>
                                <input type="text" id="state" name="state"
                                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm"
                                    required>
                            </div>
                            <div class="mb-4">
                                <label for="postal-code"
                                    class="block text-sm font-medium text-gray-700">Postal
                                    Code</label>
                                <input type="text" id="postal-code"
                                    name="postal-code"
                                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm"
                                    required>
                            </div>
                            <div class="mb-4">
                                <label for="country"
                                    class="block text-sm font-medium text-gray-700">Country</label>
                                <input type="text" id="country" name="country"
                                    class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm focus:ring-yellow-500 focus:border-yellow-500 sm:text-sm"
                                    required>
                            </div>
                            <button type="submit"
                                class="bg-yellow-600 text-white py-2 px-4 rounded hover:bg-yellow-700">Save
                                Address</button>
                        </form>
                    </div>
                </div>
                <!-- Items Cart -->
                <div
                    class="flex flex-col gap-6 bg-[#F2F2F2] p-4 md:p-6 rounded-lg border border-black-200 h-fit">
                    <!-- if cartitems is empty -->
                    <div
                        th:if="${cartItems.size() == 0}"
                        class="flex flex-col items-center justify-center">
                        <h2 class="text-lg font-semibold mb-2">Your cart is
                            empty</h2>
                        <a
                            href="/home"
                            class="bg-yellow-600 text-white py-2 px-4 rounded hover:bg-yellow-700">
                            Continue Shopping
                        </a>
                    </div>
                    <div
                        class="bg-[#FFFFFF] flex flex-row p-3 w-full rounded-xl gap-4"
                        th:each="cartItems : ${cartItems}">
                        <div class="max-w-48 border rounded-lg">
                            <img
                                class="w-full h-full object-cover object-center rounded-lg"
                                th:src="@{'/images/product/' + ${cartItems.product.image}}"
                                alt="Product Image" />
                        </div>
                        <div
                            class="flex flex-col justify-between space-y-2 w-full">
                            <div
                                class="flex flex-col sm:flex-row justify-between w-full">
                                <div>
                                    <h3
                                        class="text-xl lg:text-2xl font-bold"
                                        th:text="${cartItems.product.name}"></h3>
                                    <p
                                        class="text-red-500"
                                        th:text="${cartItems.product.stock} + ' items left'"></p>
                                </div>
                                <h3
                                    th:id="'price-' + ${cartItems.id}"
                                    class="text-lg font-bold text-nowrap"
                                    th:text="'Rp. ' + ${#numbers.formatDecimal(cartItems.totalPrice, 0, 'COMMA', 0, 'POINT')}">
                                    Harga
                                </h3>
                            </div>
                            <div class="flex justify-between items-center">
                                <div class="mt-auto self-end">
                                    <button
                                        class="px-1 py-1 border border-gray-300 rounded"
                                        th:onclick="|updateQuantity(${cartItems.id}, ${cartItems.quantity - 1})|">
                                        -
                                    </button>
                                    <input
                                        id="quantity"
                                        type="text"
                                        th:value="${cartItems.quantity}"
                                        th:data-product-id="${cartItems.id}"
                                        class="px-1 py-1 w-10 text-center border rounded-lg border-gray-300 mx-2 quantity-input" />
                                    <button
                                        class="px-1 py-1 border border-gray-300 rounded"
                                        th:onclick="|updateQuantity(${cartItems.id}, ${cartItems.quantity + 1})|">
                                        +
                                    </button>
                                </div>
                                <!-- delete icon -->
                                <form
                                    th:action="@{/cart/remove}"
                                    method="POST"
                                    class="inline-block">
                                    <input
                                        type="hidden"
                                        name="cartId"
                                        th:value="${cartItems.id}" />
                                    <button type="submit"
                                        class="text-red-500 hover:text-red-700">
                                        <i class="fa-solid fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col gap-4">
                <!-- voucher -->
                <div class="max-w-4xl">
                    <div
                        class="h-full border border-black-300 p-4 rounded bg-[#F2F2F2]">
                        <div
                            class="flex h-full items-center justify-start gap-7">
                            <i class="fa-solid fa-ticket text-5xl"></i>
                            <form
                                class="gap-5 w-full justify-center items-center">
                                <!-- Kolom Label dan Input -->
                                <label class="font-semibold mb-2"
                                    for="voucher-input">Redeem your voucher
                                    here!</label>
                                <div class="flex w-full gap-2">
                                    <input
                                        id="voucher-input"
                                        type="text"
                                        class="border border-gray-300 rounded px-3 py-2 w-full focus:outline-none focus:ring-2 focus:ring-pink-400"
                                        placeholder="Enter your voucher" />

                                    <!-- Tombol Submit -->
                                    <div class="w-1/2">
                                        <button
                                            class="bg-yellow-600 w-full text-white py-3 rounded hover:bg-yellow-700">
                                            Submit
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <!-- Order Summary -->
                <div class="grid grid-rows-2">
                    <div
                        class="border bg-[#F2F2F2] border-black-300 p-4 rounded w-auto">
                        <h2 class="text-lg font-semibold mb-5">Your order
                            summary</h2>
                        <!-- Sub-total Section -->
                        <div class="flex justify-between mb-6">
                            <span>Sub-total (<span
                                    th:text="${cartItems.size()}"></span>
                                Products)</span>
                            <span
                                th:text="'Rp. ' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')}"></span>
                        </div>
                        <!-- Horizontal Line Below Sub-total -->
                        <hr class="border-black mb-4" />

                        <!-- Savings Total Section -->
                        <div class="flex justify-between mb-6">
                            <span>Savings total</span>
                            <span>Rp. 0</span>
                        </div>
                        <div class="justify-between mb-2">
                            <span>Delivery fee</span> <br />
                            <span class="text-red-500">Add a shipping address to
                                see the cost and estimated delivery
                                time</span>
                        </div>
                        <!-- Horizontal Line Above Total -->
                        <hr class="border-black mb-2 mt-4" />

                        <!-- Total Section -->
                        <div
                            class="flex justify-between font-bold text-lg mb-7">
                            <span>Total</span>
                            <span
                                th:text="'Rp. ' + ${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')}"></span>
                        </div>
                    </div>
                    <!-- Checkout Button -->
                    <button
                        class="w-full h-1/5 bg-yellow-600 text-white py-2 rounded mt-6 hover:bg-yellow-700">
                        Checkout
                    </button>
                </div>
            </div>
        </div>

        <!--Wajib-->
        <script
            src="https://cdn.jsdelivr.net/npm/flowbite@2.5.2/dist/flowbite.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
        document.addEventListener("DOMContentLoaded", function () {
            const dropdownToggle = document.getElementById(
            "userDropdownHomeToggle"
            );
            const dropdown = document.getElementById("userDropdownHome");
            dropdownToggle.addEventListener("click", function () {
            dropdown.classList.toggle("hidden");
            });
        });
        </script>
        <script th:inline="javascript">
      function updateQuantity(cartId, newQuantity) {
        if (newQuantity < 1) return;
        const token = document.querySelector('meta[name="_csrf"]').content;

        fetch(`/cart/updateQuantity`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-TOKEN": token,
          },
          body: JSON.stringify({
            cartId: cartId,
            quantity: newQuantity,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            location.reload();
          })
          .catch((error) => console.error("Error:", error));
      }

      // Add input change listener
      document.querySelectorAll(".quantity-input").forEach((input) => {
        input.addEventListener("change", (e) => {
          const productId = e.target.dataset.productId;
          const newQuantity = parseInt(e.target.value);
          if (!isNaN(newQuantity)) {
            updateQuantity(productId, newQuantity);
          }
        });
      });
    </script>
    </body>
</html>
